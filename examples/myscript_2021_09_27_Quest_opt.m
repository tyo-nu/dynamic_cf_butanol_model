n_best = 100;


savename_base = '2021_09_27_Quest_patternsearch_init_20210924_1000cpu_4hr';
loadfile = '2021_09_24_Quest_1e8best1e3_low-PTS_combined';

jobs = cell(n_best, 1);

counter = 1;

while counter <= n_best
        
    try

        savename = strcat(savename_base, '_init_', num2str(counter));

        jobs{counter} = batch(@run_particle_swarm_optimization,0,{...
        'ecoli_butanol_trim_approx_model',...
        'Options_struct_loadfile','2021_04_01_ecoli_approx_loadfile',...
        'best_ks_loadfile',loadfile,...
        'savename', savename,...
        'k_range',[0, 1e4],...
        'unknown_sat_constant_range',[0.01, 1],...
        'rate_constant_bounds',[0.1, 10],...
        'sat_constant_bounds',[0.1, 10],...
        'SwarmSize',n_best,...
        'opt_alg','patternsearch',...
        'best_n_ksets',[],...
        'unknown_Ki_range', [5e-1, 5e1],...
        'dataset_for_sampling',1,...
        'manual_k_ranges',[444,1,40;445,0.1,2;449,0.1,1;40,10000,1000000;19,200,4000;682,0.1,2;683,1,100;685,0.005,0.5;611,0.1,4;61,3,30],...
        'optim_rate_const_bounds', [0, 1e4],...
        'optim_sat_const_bounds',[1e-3, 1e2],...
        'optim_inhib_const_bounds',[1e-1, 1e2],...
        'best_n_ksets_as_init', n_best,...
        'best_init_kset_inds', counter,...
        'metab_fitness_multipliers',{'succ_c',6;'1btoh_c',20},...
        'exp_conditions', [3,4],...
        'optim_param_bounds', [],...
        'MaxTime',3.8*3600,...
        'use_log_params',true,...
        'UseParallel',true,...
        },...
        'Profile','multinode_quest_short','Pool',999);

        pause(60*10)

        counter = counter + 1;

    catch ME

        a=1;
        pause(60*10)

    end

end
